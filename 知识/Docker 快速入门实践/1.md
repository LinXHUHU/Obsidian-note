# UiniFS 技术的背景以及应用

**[Docker 镜像 | Docker 从入门到实践 (docker-practice.com)](https://vuepress.mirror.docker-practice.com/basic_concept/image/)**

**重点是写时复制技术**



## 前言：
任何程序运行时都会有依赖，如：开发语言层的依赖库或者各种系统lib。不同的系统上这些
依赖可能是不一样的，或者有缺失的。为了让容器运行时一致，docker将依赖的操作系统、各种lib
整合打包在一起（即镜像），然后容器启动时，作为它的根目录（根文件系统rootfs），使容器进程
的各种依赖调用都在这个根目录里，这样就做到了环境的一致性。

## 出现背景：
如果每开发一个应用，都要重复制作一次rootfs，那不是非常麻烦？
比如，用自身操作系统的ISO做了一个rootfs，然后又在里面安装了Golang环境，用来部署应用A。
那么，在发布另一个Golang应用B时，希望能够直接使用安装过Golang环境的rootfs，而不是重复
这个流程，那么UnionFS就派上用场了。

## Docker镜像的设计：
引入了层（layer）的概念，制作镜像的每一步操作，都会生成一个层，就是一个增量rootfs（一个
目录），这样应用A和应用B所在的容器共同引用相同的操作系统层、Golang环境层（作为只读层），
而各自有各自应用程序层，和可写层。启动容器的时候通过UnionFS把相关层挂载到一个目录，作为
容器的根文件系统。

## 如果需要修改内核参数，那么得注意：
rootfs只是一个操作系统所包含的文件、配置和目录，并不包括操作系统内核。这就意味着，如果你
的应用程序需要配置内核参数、加载额外的内核模块以及跟内核进行直接的交互，这些操作和依赖的
对象，都是宿主机操作系统内核，它对于该机器上所有容器来说是一个“全局变量”，牵一发动全身。